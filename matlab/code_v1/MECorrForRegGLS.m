function R=MECorrForRefGLS(X,MEX,Vall,bootflag,alpha,reps)% MECorrForRegGLS.m% number of tips and variables[n p]=size(X);U=ones(n,1);R=zeros(p,p);for i=1:p-1	for j=i+1:p		X1=X(:,i);		X2=X(:,j);				CX1=Vall(:,:,i);		CX2=Vall(:,:,j);		iDX1=chol(CX1)';		iDX2=chol(CX2)';		DX1=iDX1\eye(n);		DX2=iDX2\eye(n);		CX12=iDX1*iDX2';				invV1=CX1\eye(n);		invV2=CX2\eye(n);		invV12=CX12\eye(n);		a1=(U'*invV1*U)\(U'*invV1*X1);		a2=(U'*invV2*U)\(U'*invV2*X2);		s2X1=(X1-U*a1)'*invV1*(X1-U*a1)/(n-1);		s2X2=(X2-U*a2)'*invV2*(X2-U*a2)/(n-1);		sX1=s2X1^.5;		sX2=s2X2^.5;		% calculate correlation			c=(X2-a2)'*invV12*(X1-a1)/(n-1);		r=c/(sX1*sX2);		R(i,j)=r;	endendR=R+R'+eye(p);