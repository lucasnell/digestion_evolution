

This section displays all results from analyses using
`phylolm::phylolm` `r citep(citation("phylolm"))` and 
a modified version of `ape::corphylo`
`r citep(list(citation("ape"), "10.1111/j.1365-2435.2009.01596.x"))`
that provides parametric bootstrapping.

In the tables below, the "estimate" column is the maximum likelihood estimate 
for the specified parameter, 
while columns "lower" and "upper" are lower and upper bounds of the 95% confidence 
interval for the parameter estimate.
"P" is the p-value for a parameter not being equal to zero.
Both p-values and CIs were obtained by parametric bootstrapping of the `phylolm`
or `corphylo` model.
We do not present P-values for phylogenetic signals because they were bound
above zero by the models; thus confidence intervals are more informative.


 
```{r results-libraries, echo = FALSE, cache = FALSE}
# Packages needed for this script 
suppressPackageStartupMessages({
    library(readr)
    library(dplyr)
    library(tidyr)
    library(stringr)
    library(purrr)
    library(phylolm)
    library(ape)
    library(ggplot2)
    library(grid)
    library(gridExtra)
})
# Set default ggplot2 theme
# setting default `ggplot2` theme
theme_set(theme_classic() %+replace% 
              theme(strip.background = element_blank(),
                    strip.text = element_text(size = 11, face = 'italic'),
                    legend.title = element_blank(),
                    legend.background = element_blank(),
                    plot.title = element_text(size = 14, hjust = 0)))
# Custom package that does bootstrapping on corphylo object
suppressMessages(devtools::load_all('corphyloCpp'))
# Sourcing scripts from R directory
invisible(sapply(list.files('R', '*.R', full.names = TRUE), source))

# Function to turn parameter values to Greek versions
greekify <- function(parameters) {
    if (is.factor(parameters)) parameters <- paste(parameters)
    sapply(
            parameters, 
            function(.p){
                switch(.p, 
                       `(Intercept)` = "$\\beta_0$",
                       cladeBat = "$\\beta_{\\text{clade}}$",
                       dietOmnivorous = "$\\beta_{\\text{omniv.}}$",
                       dietProtein = "$\\beta_{\\text{carniv.}}$",
                       lambda = "phylo$_{\\lambda}$",
                       alpha = "phylo$_{\\alpha}$",
                       d = "phylo$_d$",
                       sprintf("$\\beta_{\\text{%s}}$", gsub("log_", "", .p))
                   )
            }
        )
}

# Clean up Y variables for tables
clean_Y <- function(Y, track_log = TRUE) {
    Yp <- Y %>% 
        str_replace_all('log_', '') %>% 
        str_replace_all('_', ' ') %>% 
        str_replace_all('sef', 'SEF') %>% 
        str_replace_all('nsa', 'NSA') %>% 
        str_replace_all('absorp', 'absorption') %>% 
        str_replace_all('vill ', 'villous ')
    if (track_log) {
        Ypp <- str_c(Yp, '$^{\\dagger}$')
        return(ifelse(str_detect(Y, '^log_'), Ypp, Yp))
    } else {
        return(Yp)
    }
}


# Parse scientific notation into a string for LaTeX
parse_scinot <- function(string) {
    if (str_detect(string, 'e')) {
        string <- str_split(string, 'e') %>% 
            map_chr(~ sprintf('%s \\mathrm{e}{%s}', .x[1], as.numeric(.x[2])))
    }
    return(sprintf('$%s$', string))
}


# Function to print data frames for LaTeX output using booktabs package
pretty_df <- function(df_, caption = NULL) {
    edit_nums <- function(.df){
        .df %>% 
            mutate_if(is.numeric, 
                      function(x) {
                          x %>% sprintf(fmt = '%.4g') %>% 
                              sapply(., parse_scinot)
                      })
    } 
    if (is(df_, 'list')) {
        df_ <- lapply(df_, edit_nums)
    } else {
        df_ <- edit_nums(df_)
    }
    kable_obj <- knitr::kable(df_, format = 'latex', booktabs = TRUE, caption = caption,
                              escape = FALSE)
    kable_str <- unlist(str_split(kable_obj, '\n'))
    kable_str <- kable_str[kable_str != "\\addlinespace"]
    for (i in 1:(length(kable_str)-1)) {
        if (grepl('^ &', kable_str[i]) & !grepl('^ &', kable_str[(i+1)]) & 
            !grepl('^\\bottomrule', kable_str[(i+1)])) {
            kable_str[i] <- str_c(kable_str[i], "\n", "\\addlinespace")
        }
    }
    new_kable_str <- str_c(kable_str, collapse = '\n')
    kable_obj[1] <- new_kable_str
    return(kable_obj)
}
``` 
 
 
```{r results-parse-output, echo = FALSE} 
summ_df <- read_csv('output/models_summaries.csv', col_types = 'ccccdddd') %>%
    mutate(X = ifelse(X == 'cladeBat', 'clade', X),
           pos = ifelse(is.na(pos), 'all', pos)) %>%  
    rename(estimate = value) %>%
    select(pos, Y, X, phy_model, estimate, lower, upper, P) %>% 
    mutate_if(is.numeric, function(s) signif(s, digits = 4)) %>% 
    mutate(model = ifelse(phy_model == 'OU', 'corphylo', 'phylolm'),
           P = ifelse(X %in% c('lambda', 'd', 'alpha'), "â€“", sprintf("$%.3f$", P)),
           # Explicitly ordering parameters:
           X = factor(X, 
                      levels = c("clade", "log_mass", 
                                 "dietOmnivorous", "dietProtein", 
                                 "log_clear", "log_total_enterocytes", 
                                 "lambda", "alpha", "d"))) %>% 
    rename(parameter = X) %>% 
    nest(-model, -pos)
plm_mods <- list(absorp = read_rds('output/models_absorp.rds'),
               diet = read_rds('output/models_diet.rds'),
               pos = read_rds('output/models_pos.rds'),
               spp = read_rds('output/models_spp.rds'))
cp_mod <- read_rds('output/models_corphylo.rds')
```







## `phylolm`

### Model estimates

Tables \ref{tab:results-spp-summs}--\ref{tab:results-dist-summs} summarize the 
coefficient estimates for all `phylolm` model fits. 
The "Y" column indicates the dependent variable for the model, and 
vertical whitespace separates rows of different models.
When the "parameter" column is of the form $\beta_X$, it refers to the coefficient 
for independent variable $X$. $X$ is one of the following:

- clade: binary variable whose value is 1 if the species is a bat (0 if a rodent)
- mass: log-transformed body mass
- omniv.: binary variable whose value is 1 if the species is omnivorous
- carniv.: binary variable whose value is 1 if the species is carnivorous

When the "parameter" column is of the form phylo$_Y$, it refers to the 
phylogenetic signal parameter $Y$;
$Y$ takes different values depending on the phylogenetic error term:
$\lambda$ for Pagel's lambda and $\alpha$ for Ornstein-Uhlenbeck.


```{r results-spp-summs} 
filter(summ_df, pos == 'all', 
                          model == 'phylolm')$data[[1]] %>% 
    arrange(Y, parameter) %>%
    mutate(Y = ifelse(Y == lag(Y, default = 'XXX'), "", Y) %>% clean_Y(track_log = FALSE),
           parameter = greekify(parameter)) %>% 
    select(-phy_model) %>%
    pretty_df(., caption = str_c('\\texttt{phylolm} model summaries for analyses ',
                                 'by species only. ',
                                 'All Y variables were log-transformed for these ',
                                 'analyses'))
``` 


```{r results-prox-summs} 
filter(summ_df, pos == 'prox', model == 'phylolm')$data[[1]] %>% 
    arrange(Y, phy_model, parameter) %>%
    mutate(Y = ifelse(Y == lag(Y, default = 'XXX') & 
                          phy_model == lag(phy_model, default = 'XXX'),
                      "", Y) %>% clean_Y(),
           Y = ifelse(phy_model == 'OUfixedRoot' & Y != '', 
                      str_c(Y, '$^{\\star}$'), Y),
           parameter = greekify(parameter)) %>% 
    select(-phy_model) %>% 
    pretty_df(., caption = str_c('\\texttt{phylolm} model summaries for proximal ',
                                 'intestinal segment analyses. ',
                                 '$\\dagger$ indicates Y variables that were ',
                                 'log-transformed. ',
                                 '$\\star$ indicates the model that was fit using ',
                                 'the Ornstein-Uhlenbeck model for the phylogenetic ',
                                 'error term (see "Uncertainty in regression of ',
                                 'proximal crypt width on clade" below for more ',
                                 'information on this model fit).'))
``` 


```{r results-med-summs} 
filter(summ_df, pos == 'med', model == 'phylolm')$data[[1]] %>% 
    arrange(Y, parameter) %>%
    mutate(Y = ifelse(Y == lag(Y, default = 'XXX'), "", Y) %>% clean_Y(),
           parameter = greekify(parameter)) %>% 
    select(-phy_model) %>% 
    pretty_df(., caption = str_c('\\texttt{phylolm} model summaries for medial ',
                                 'intestinal segment analyses. ',
                                 '$\\dagger$ indicates Y variables that were ',
                                 'log-transformed.'))
``` 


```{r results-dist-summs}
filter(summ_df, pos == 'dist', model == 'phylolm')$data[[1]] %>% 
    arrange(Y, parameter) %>%
    mutate(Y = ifelse(Y == lag(Y, default = 'XXX'), "", Y) %>% clean_Y(),
           parameter = greekify(parameter)) %>% 
    select(-phy_model) %>% 
    pretty_df(., caption = str_c('\\texttt{phylolm} model summaries for distal ',
                                 'intestinal segment analyses. ',
                                 '$\\dagger$ indicates Y variables that were ',
                                 'log-transformed.'))
``` 


### Uncertainty in regression of proximal crypt width on clade

The model for `crypt_width ~ clade` in the proximal segment, when using Pagel's 
$\lambda$, estimates a very strong phylogenetic signal 
(Table \ref{tab:results-prox-summs}).
When providing a low starting value for $\lambda$ ($\lambda = 0.1$), 
the model converges to a very weak phylogenetic signal ($\lambda = 10^{-7}$),
but it still has a higher log likelihood at the strong phylogenetic signal 
($\ell = 68.14$ at $\lambda = 0.993$) than at the weak signal 
($\ell = 66.88$ at $\lambda = 10^{-7}$).

However, this model is sensitive to starting values, which suggests multiple peaks in
the likelihood profile.
Moreover, the models for the other segments show very weak phylogenetic signal 
($\lambda = 10^{-7}$ for both), 
and this model re-run with the Ornstein-Uhlenbeck model for phylogenetic error 
("OU"; `OUfixedRoot` in `phylolm`) has a higher log likelihood and
shows a much weaker phylogenetic signal ($\ell = 68.54$ and $\alpha = 0.0156$) than
the version run with Pagel's lambda.
Thus the model likely had convergence issues using Pagel's lambda, so we
replaced the original model with one using the OU error model.




### Influential values

In the `phylolm` model for `log_intestinal_length ~ clade`, one point is very
influential to the results, which might make us less confident in the conclusions 
from the full dataset.

#### Jackknifing methodology

We used jackknifing to determine how influential each point is to model estimates.
We first conducted jackknife replicates (1 per row in the dataset), where, for
replicate $i$, we removed row $i$ from the dataset and fit a `phylolm` model.
This resulted in an $n$ by $p$ matrix of the jackknifed coefficient estimates
($\mathbf{B}$), 
where $n$ is the sample size and $p$ the number of coefficients estimated.
For column $j$ from 1 to $p$, we did the following:

\begin{equation}
\label{eq:jackknife}
\begin{split}
    \mathbf{\hat{B}}_j &= \mathbf{B}_j - \mathbf{b}_{(0)j} \\
    \mathbf{\tilde{B}}_j &= \frac{ \mathbf{\hat{B}}_j - \mu_{\mathbf{\hat{B}}_j} }{ 
        \sigma_{\mathbf{\hat{B}}_j} }
\end{split}
\end{equation}

where $\mathbf{B}_j$ refers to column $j$ in $\mathbf{B}$,
$\mu_{\mathbf{\hat{B}}_j}$ and $\sigma_{\mathbf{\hat{B}}_j}$ are the mean and 
standard deviation of $\mathbf{\hat{B}}_j$ respectively,
and $\mathbf{b}_{(0)j}$ is the $j$th item from the initial vector of coefficient 
estimates using the full dataset.
The output $n$ by $p$ matrix, $\mathbf{\tilde{B}}$, presents influence-value
Z-scores (scaled to have a standard deviation of one and mean of zero).
We used the absolute value of these Z-scores for plotting.



#### Jackknifing results

Figures \ref{fig:results-influence-plots1} and \ref{fig:results-influence-plots2}
show that one species (*Artibeus lituratus*) has a disproportionate effect on all 
three coefficient estimates.


```{r results-influence-jack, cache = TRUE}
# (See `R/model_summaries.R` for the `jack_phylolm` function.)
int_jack <- jack_phylolm(plm_mods$spp$log_intestinal_length, 
                         phy = get_tr('spp'))
```



```{r results-influence-plots1, fig.height = 4, fig.width = 7, fig.cap = "Plot of absolute Z-scores of influence values for the regression of intestinal length on clade and body mass. Point color indicates which parameter the influence-values pertain to."}
# Adding morphometric data to the jackknife data frame
jack_df <- dplyr::left_join(int_jack, get_df('spp'), by = 'species') %>% 
    select(diet, clade, species, estimate, influence, log_mass, log_intestinal_length) %>% 
    mutate(estimate = factor(estimate, levels = c('cladeBat', 'log_mass', 'intercept'), 
                             labels = c('clade', 'body mass', 'intercept')))

# Plotting to show better the actual |Z-scores|
jack_df %>%
    ggplot(aes(reorder(species, abs(influence)), abs(influence), color = estimate)) +
    # geom_col() +
    geom_segment(aes(xend = species), yend = 0, color = 'gray40') +
    geom_point(size = 2, color = 'dodgerblue') +
    scale_color_manual(values = c('#1b9e77','#d95f02','#7570b3')) +
    facet_wrap(~ estimate) +
    coord_flip() +
    ylab("Influence absolute Z-score") +
    theme(legend.position = 'top',
          legend.justification = c(0.5, 0),
          axis.title.y = element_blank(),
          axis.text.y = element_text(face = 'italic'), 
          plot.title = element_text(size = 16, margin = margin(0,0,0,0)))
```

```{r results-influence-plots2, fig.height = 4, fig.width = 7, fig.cap = "Plot of influential points for the regression of intestinal length on clade and body mass. Point sizes are proportional to their influence absolute Z-score. Facet labels indicate which parameter influence-values pertain to, and color indicates clade. Both axes are on the log scale."}
# Plot showing context of influential values
jack_df %>%
    # Exponentiate variables for plotting so we can more transparently
    # provide axis labels of the non-transformed numbers.
    # The same is done below when plotting the raw data.
    mutate_at(vars(log_mass, log_intestinal_length), exp) %>% 
    ggplot(aes(log_mass, log_intestinal_length, color = clade, size = abs(influence))) +
    geom_point() +
    # All these plots include log(mass) on the x-axis so we're including this here.
    scale_x_continuous('Body mass (g)', trans = 'log', breaks = 10 * 4^(0:2),
                       limits = exp(c(2.043877, 5.199205)), expand = c(0,0)) +
    scale_y_continuous('Intestinal length (cm)', trans = 'log', breaks = 10*2^(0:2)) +
    facet_grid(~ estimate) +
    scale_size_area('Influence |Z-score|:', breaks = 1:2, max_size = 4) +
    scale_color_manual('Clade:', values = c('#9ecae1', '#de2d26')) +
    theme(legend.title = element_text(size = 10, face = 'bold.italic'),
          legend.position = 'top', 
          plot.title = element_text(size = 16, margin = margin(0,0,0,0)))
```




#### Re-running model without influential point

```{r results-influence-firstrun}
influence_og <- plm_mods$spp$log_intestinal_length
first_run_df <- cbind(cbind(estimate = c(influence_og$coefficients, 
                                         lambda = influence_og$optpar)),
                      t(influence_og$bootconfint95)[c("(Intercept)", "cladeBat", 
                                                      "log_mass", "lambda"), ]) %>% 
    as_tibble %>% 
    rename(lower = `2.5%`, upper = `97.5%`) %>% 
    mutate(parameter = c("(Intercept)", "cladeBat", "log_mass", 
                         "lambda")) %>% 
    select(parameter, everything())
```


```{r results-influence-rerun, cache = TRUE}
spp_df <- get_df('spp')
spp_tr <- get_tr('spp')
.df <- get_df('spp')
.df <- .df[.df$species != 'Artibeus lituratus',]
.tr <- get_tr('spp') %>% filter_tr(.df$species)
set.seed(1018666821)
suppressWarnings(  # gives warning about low lambda
    influence_rerun <- phylolm(log_intestinal_length ~ clade + log_mass, 
                               model = 'lambda', data = .df, boot = 2000, 
                               phy = .tr))
```



Table \ref{tab:results-re-run-summ-dfs} compares summaries of this model 
with and without the influential value.
When that point is removed, we are much less sure about mass's influence on 
intestinal length.
It does not, however, change our conclusions regarding the influence of clade
(P-value for $\beta_{\text{clade}}$ with influential point:
`r sprintf("%.3f", pval(influence_og, 'cladeBat'))`;
P without it: `r sprintf("%.3f", pval(influence_rerun, 'cladeBat'))`).


```{r results-re-run-summ-dfs}
rerun_df <- cbind(cbind(estimate = c(influence_rerun$coefficients, 
                                     lambda = influence_rerun$optpar)),
                  t(influence_rerun$bootconfint95)[c("(Intercept)", "cladeBat", 
                                                     "log_mass", "lambda"), ]) %>% 
    as_tibble %>% 
    rename(lower = `2.5%`, upper = `97.5%`) %>% 
    mutate(parameter = c("(Intercept)", "cladeBat", "log_mass", 
                         "lambda")) %>% 
    select(parameter, everything())
list(first_run_df, rerun_df) %>% 
    lapply(function(x) {
        mutate(x, parameter = greekify(parameter))
    }) %>% 
    pretty_df(., caption = str_c('\\texttt{phylolm} model estimates for regression of ',
                                 'log(intestinal length) on clade and log(body mass), ',
                                 'with (left) and  without (right) influential point ',
                                 'present in dataset.'))
```
















## `corphylo`

Table \ref{tab:results-clear-sef-kable}
refers to `corphylo` estimates for the correlation between clearance and SEF.
The table includes the Pearson correlation coefficient ($r$) between the two traits 
and phylogenetic signals from an Ornstein-Uhlenbeck process for each individual trait.


```{r results-clear-sef-kable}
filter(summ_df, model == 'corphylo')$data[[1]] %>% 
    mutate(Y = str_replace_all(Y, 'log_', '') %>% str_replace_all('_', ' '), 
           parameter = c('$r$', sprintf('$d_{\\text{%s}}$', gsub('log_', '', Y[2])), 
                         sprintf('$d_{\\text{%s}}$', gsub('log_', '', Y[3])))) %>% 
    select(-phy_model, -Y) %>% 
    pretty_df(., caption = str_c('\\texttt{corphylo} model summary for the ',
                                 'correlation between clearance and SEF. ',
                                 '$r$ indicates the correlation and $d_X$ indicates ',
                                 'the phylogenetic signal from an Ornstein-Uhlenbeck ',
                                 'process for variable $X$. ',
                                 'Both variables were log-transformed for this ',
                                 'analysis.'))
```




### Influential value for clearance and SEF

In the `corphylo` model for `clearance ~ SEF`, one point is very
influential to the results, which might make us less confident in the conclusions 
from the full dataset.

#### Jackknifing

We used jackknifing to determine how influential each point is to the correlation 
estimate.
See equation \ref{eq:jackknife} for how I calculated absolute influence values.


Figures \ref{fig:results-influence-plot-cp1} and \ref{fig:results-influence-plot-cp2}
show that one species 
(*Tadarida brasiliensis*) has a disproportionate effect on the correlation.


```{r results-influence-jack-corphylo}
# (See `R/model_summaries.R` for the `jack_corphylo` function.)
clear_df <- get_df('clear')
clear_se_df <- get_df('clear', .stat = 'se')
clear_tr <- get_tr('clear')
cp_jack <- jack_corphylo(cp_mod, mean_df = clear_df, se_df = clear_se_df,
                         phy = clear_tr, par_names = c('log_sef', 'log_clear'))
```



```{r results-influence-plot-cp1, fig.height = 3, fig.width = 6, fig.cap = "Plot of absolute Z-scores of influence values for the correlation (Pearson's $r$) between clearance and SEF."}
# Adding morphometric data to the jackknife data frame
cor_jack_df <- dplyr::left_join(cp_jack, get_df('clear'), by = 'species') %>% 
    select(diet, clade, species, log_sef, log_clear, influence)

# Plotting it
cor_jack_df %>%
    ggplot(aes(reorder(species, abs(influence)), abs(influence))) +
    geom_segment(aes(xend = species), yend = 0, color = 'gray40') +
    geom_point(size = 2, color = 'dodgerblue') +
    theme(axis.title.y = element_blank(),
          axis.text.y = element_text(face = 'italic')) +
    coord_flip() +
    ylab("Influence absolute Z-score")
```


```{r results-influence-plot-cp2, fig.height = 4, fig.width = 4, fig.cap = "Plot of influential points for the correlation (Pearson's $r$) between clearance and SEF. Point sizes are proportional to their influence absolute Z-score on the estimate of Pearson's $r$. Color indicates clade, and both axes are on the log scale."}

cor_jack_df %>%
    # Exponentiate variables for plotting so we can more transparently
    # provide axis labels of the non-transformed numbers.
    # The same is done below when plotting the raw data.
    mutate_at(vars(log_sef, log_clear), exp) %>%
    ggplot(aes(log_sef, log_clear, color = clade, size = abs(influence))) +
    geom_point() +
    scale_x_continuous("Surface enlagement factor (SEF)",
                       trans = 'log', breaks = 8 * 1.5^(0:2)) +
    scale_y_continuous(bquote(.("L-arabinose clearance (") * mu *
                                  l ~ min^{-1} ~ cm^{-2} * ")"),
                       trans = 'log', breaks = 1 * 3^(0:2)) +
    scale_size_area('Influence |Z-score|:', breaks = 1:2, max_size = 4) +
    scale_color_manual('Clade:', values = c('#9ecae1', '#de2d26')) +
    theme(legend.position = 'top',
          legend.title = element_text(size = 10, face = 'bold.italic'),
          legend.box = 'vertical', legend.margin = margin(-7.5,0,-7.5,0),
          legend.box.just = 'right')
```







#### Re-running model without influential point

```{r results-influence-rerun-corphylo, cache = TRUE}
Xmat <- cp_mat(clear_df, c('log_sef', 'log_clear'))
Xmat <- Xmat[clear_df$species != 'Tadarida brasiliensis',]
MEmat <- cp_mat(clear_se_df, c('log_sef', 'log_clear'))
MEmat <- MEmat[clear_se_df$species != 'Tadarida brasiliensis',]
tr_ <- clear_tr %>% filter_tr(rownames(Xmat))
set.seed(1052373084)
influence_rerun <- corphylo_cpp(X = Xmat, phy = tr_, SeM = MEmat,
                                boot = 2000, n_cores = 4)
```


Table \ref{tab:results-re-run-summ-dfs-corphylo} shows the `corphylo` output
when this influential point is excluded.

```{r results-re-run-summ-dfs-corphylo}
rerun_df <- data_frame(parameter = c('$r$', '$d_{\\text{sef}}$', 
                                     '$d_{\\text{clear}}$'),
                       estimate = c(influence_rerun$cor.matrix[1,2], 
                                    influence_rerun$d),
                       lower = apply(influence_rerun$bootstrap, 2, 
                                     quantile, probs = 0.025),
                       upper = apply(influence_rerun$bootstrap, 2, 
                                     quantile, probs = 0.975),
                       P = c(pval(influence_rerun)[1], rep("â€“", 2)))
rerun_df %>% 
    pretty_df(., caption = str_c('\\texttt{corphylo} model summary for the ',
                                 'correlation between clearance and SEF ',
                                 'without the most influential point. ',
                                 '$r$ indicates the correlation and $d_X$ indicates ',
                                 'the phylogenetic signal from an Ornstein-Uhlenbeck ',
                                 'process for variable $X$. ',
                                 'Both variables were log-transformed for this ',
                                 'analysis.'))
```











## Percent differences

This section calculates the percent differences mentioned in the discussion and abstract.

We calculated rodent and bat estimates at `log(body mass) = 0` to remove the effect
of body mass.
Since all these variables were log-transformed, we then exponentiated
both rodent and bat estimates before computing the proportional, then percentage, 
difference:

\begin{equation}
    100 \times \frac{ \exp\left( \beta_0 + \beta_{\text{clade}} \right) - 
        \exp\left( \beta_0 \right) }{ \exp\left( \beta_0 \right) }
\end{equation}


where $\beta_0$ is the intercept and $\beta_{\text{clade}}$ the coefficient for clade.


```{r results-percent-diff}
perc_diff <- function(.mod) {
    
    # Detect log-transform from formula
    logged <- grepl('^log', paste(.mod$formula)[2])
    
    coefs <- {.mod %>% summary %>% coef}[,'Estimate']
    rodents <- coefs[['(Intercept)']]
    bats <- rodents + coefs[['cladeBat']]
    if (logged) {
        rodents <- exp(rodents)
        bats <- exp(bats)
    }
    prop_diff <- (bats - rodents) / rodents
    return(prop_diff * 100)
}
```


```{r results-percent-diff-nsa}
pd_nsa <- perc_diff(plm_mods$spp$log_nsa) %>% 
    signif(digits = 4)
```
```{r results-percent-diff-sef}
pd_sef <- mean(c(
    perc_diff(plm_mods$pos$prox$log_sef),
    perc_diff(plm_mods$pos$med$log_sef),
    perc_diff(plm_mods$pos$dist$log_sef))) %>% 
    signif(digits = 4)
```
```{r results-percent-diff-ent-dens}
pd_ed <- mean(c(
    perc_diff(plm_mods$pos$prox$log_enterocyte_density), 
    perc_diff(plm_mods$pos$med$log_enterocyte_density), 
    perc_diff(plm_mods$pos$dist$log_enterocyte_density))) %>% 
    signif(digits = 4)
```


- __NSA\:__ $`r pd_nsa`$\%
- __SEF\:__ $`r pd_sef`$\%
- __Enterocyte density\:__ $`r pd_ed`$\%





