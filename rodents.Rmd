---
title: "Rodent phylogenetic tree"
author: "Lucas Nell"
output:
  html_document:
    highlight: pygments
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE, eval = TRUE, comment = '', prompt = FALSE)
```


# Background








I first need to `source` the `'tree_preamble.R'` file to load necessary R packages and 
make the data frame of species names.

```{r, message = FALSE, warning = FALSE}
source('tree_preamble.R')
```





# Schenk

```{r}
schenk <- get_study(study_id = 'pg_2859', object_format = 'phylo')
schenk$tip.label <- gsub('_', ' ', schenk$tip.label)

sp_df$species[sp_df$type == 'rodent' & ! sp_df$species %in% schenk$tip.label]

'Oligoryzomys nigripes' %in% schenk$tip.label


```



# Fabre

Using `rotl` directly didn't work for this paper's tree, so I downloaded the Newick 
version directly from the link on 
[OTOL's site](https://tree.opentreeoflife.org/curator/study/view/pg_2688/?tab=metadata).

```{r, engine = 'bash', eval = FALSE}
wget "https://api.opentreeoflife.org/v3/study/pg_2688.tre"
mv pg_2688.tre rodents.tre
```

I then opened this file in a text editor and removed all single quotes and replaced all
spaces with underscores. This allows R to read this file appropriately. After it's read,
I can replace underscores with spaces.

```{r}
rod_tr <- read.tree('rodents.tre')
rod_tr$tip.label <- gsub('_', ' ', rod_tr$tip.label)
rod_tr$node.label <- gsub('_', ' ', rod_tr$node.label)

# Setting NA values to zero, then will collapse these into multichotomies
rod_tr$edge.length[is.na(rod_tr$edge.length)] <- 0
rod_tr <- di2multi(rod_tr) %>% 
    # Removing unnecessary tips
    drop.tip(., tip = c(2260:2165, 685, 686))
rod_tr

which(rod_tr$node.label == 'Mus musculus') + length(rod_tr$tip.label)
sapply(sp_df$species[sp_df$type == 'rodent'], function(x) which(rod_tr$tip.label == x)[1])
sapply(sp_df$species[sp_df$type == 'rodent'], function(x) which(rod_tr$node.label == x)[1])
```



If you want to make a pdf of this tree that's (somewhat) readable:
```{r, eval = FALSE}
font_size <- 0.05
pdf('rod_tree.pdf', width = 6, height = 24)
    plot(rod_tr, cex = font_size, edge.width = 0.25, no.margin = TRUE, label.offset = 0.5)
    nodelabels(frame = 'none', cex = font_size, adj = c(1, 0))
    tiplabels(frame = 'none', cex = font_size, adj = c(0, 0.5))
dev.off()
```

Three species don't seem to be present in either node or tip labels.

```{r}
sp_df$species[sp_df$type == 'rodent' & 
                  !sp_df$species %in% c(rod_tr$node.label, rod_tr$tip.label)]
```


However, looking these up in the OTOL database, I found the following:
- *Olygoryzomys nigripes* is spelled *Oligoryzomys nigripes*
  [link](https://tree.opentreeoflife.org/taxonomy/browse?id=752853)
- *Sooretamys angouya* is synonymous with *Oryzomys angouya*
  [link](https://tree.opentreeoflife.org/taxonomy/browse?id=1039661)
- *Euryoryzomys russatus* is synonymous with *Oryzomys russatus*
  [link](https://tree.opentreeoflife.org/taxonomy/browse?id=739)

When these are taken into account, all species are found in this tree.

```{r}

sp_df$species[sp_df$type == 'rodent' & sp_df$species %in% rod_tr$node.label]

extract.clade(rod_tr, node = 'Mus musculus') %>% plot
nodelabels(); tiplabels()

extract.clade(rod_tr, node = 'Thaptomys nigrita') %>% plot
nodelabels(); tiplabels()

extract.clade(rod_tr, node = 'Delomys sublineatus') %>% plot
nodelabels(); tiplabels()
```





